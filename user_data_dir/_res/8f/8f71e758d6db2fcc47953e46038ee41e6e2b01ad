{"title": "The reality of running a production Node app on AWS Elastic Beanstalk", "byline": "freeCodeCamp.org", "dir": null, "lang": "en", "content": "<div class=\"page\" id=\"readability-page-1\"><div id=\"site-main\">\n<article><h1>The reality of running a production Node app on AWS Elastic Beanstalk</h1>\n<section>\n<section data-test-label=\"post-content\">\n<p>by Jared Nutt</p><h4 id=\"lessons-learned-from-2-years-of-running-a-production-node-app-on-aws-elb-platform\">Lessons learned from 2 years of running a production Node app on AWS\u2019 ELB platform</h4><h3 id=\"front-matter\">Front-Matter</h3><p>Let\u2019s be honest, the <a href=\"https://calculator.s3.amazonaws.com/index.html\" rel=\"noopener\">AWS pricing calculator</a> is confusing. Part of that is because of the <em>a la carte</em> method of payments AWS offers. This makes trying to give a good quote to a client difficult. Hopefully this article can provide some light on how much it costs to run an app, as well as some ways to reduce cost.</p><h3 id=\"the-real-cost-of-running-an-app\">The Real Cost of Running an App</h3><p>I\u2019ve been managing a node web-app on ELB for about two years now. The first year was great, they gave you everything for free (mostly)! After that, you have to start paying for stuff, like EC2 instances.</p><p>This article will focus on my specific app requirements, which is a node based express app that is hosted on Elastic Beanstalk.</p><p>For full details about the build, see my previous article <a href=\"https://medium.freecodecamp.org/how-to-deploy-a-node-js-app-to-the-aws-elastic-beanstalk-f150899ed977\" rel=\"noopener\">here</a>.</p><h4 id=\"breakdown\">Breakdown</h4><p>This is what I\u2019m currently running on AWS:</p><p>Single EBS Environment (U.S. West Region):</p><ul><li>1 Classic Load Balancer</li><li>1 t2.micro EC2 instance</li><li>S3 Bucket that holds images (7 GB at time of writing)</li><li>1 Route 53 Hosted Zone</li></ul><p><strong>$18 </strong>(Load Balancer) +<strong> $5</strong> (EC2 with an RI) + <strong>$0.50</strong> (Route 53) + <strong>$0.17 </strong>(S3) +<strong> $0.21</strong> (Data Transfer) = Roughly <strong>$25 </strong>a month.</p><p>Additionally, I host a MongoDB elsewhere, so if you plan on hosting a DB on AWS, that will incur additional costs. Let\u2019s break down the various costs.</p><h4 id=\"load-balancer\">Load Balancer</h4><p>This is the most expensive part of the stack. It costs:</p><ul><li>$0.025 per Classic Load Balancer-hour (or partial hour)</li><li>$0.008 per GB of data processed by a Classic Load Balancer</li></ul><p>That means, if you run your app 24 hours a day, it will cost roughly $18 + data charges, every month.</p><h4 id=\"ec2-instance\">EC2 Instance</h4><p>On-Demand EC2 instances are more expensive than they should be. To save some money here, refer to the section below about Reserved EC2 Instances. In case you were wondering, it would cost $8.40 to run the same type of EC2 instance as mentioned above, on-demand.</p><h4 id=\"s3\">S3</h4><p>I have a couple S3 buckets. One for my static home page, one for holding images and one for holding the application version. As far as I know, ELB automatically creates the one for managing the application versions.</p><p>The S3 is pretty cheap, so I\u2019m not too worried about trying to nickel and dime it, but there are ways to save money via their <a href=\"https://aws.amazon.com/glacier/\" rel=\"noopener\">Glacier</a> system.</p><h4 id=\"database\">Database</h4><p>I host my MongoDB DB at mLab, which is going away soon. So I\u2019ll update this when I sort out how much that is actually gonna cost once I\u2019m forced to move over to Mongo\u2019s Atlas.</p><h3 id=\"reserved-ec2-instances\">Reserved EC2 Instances</h3><p>Let\u2019s talk about Reserved Instances (RI). Amazon\u2019s convoluted billing system is the most confusing part about managing anything on AWS. Reserved Instances can alleviate some of the cost, but are way too confusing.</p><p>After a lot of reading and talking with the AWS customer service, this is what I sorta figured out.</p><p>First, there are two different ways you can reserve where the RI is: Regional and Availability Zone. Regional means, it is specific to one of the main regions, eg. us-west-2 (Oregon). The availability zone (AZ) is specific to a zone within that region, e.g. us-west-2<strong>a </strong>(Oregon).</p><p>I bought an RI within us-west-2 and it was automatically applied to my instance running in that area. If you buy one within the AZ, it will only apply to the specific AZ, e.g. us-west-2a, so if ELB spins up an EC2 instance in us-west2b, you\u2019re out of luck.</p><p>Additionally, there are \u201cstandard\u201d and \u201cconvertible\u201d types of RIs. I\u2019m not 100% on what that means, but from what I understand convertible is more flexible on what you can swap it to, but more expensive.</p><p>Finally, there are three types of payment types: No Up-front, partial Up-front, All Up-Front. This is pretty straightforward, you either pay nothing, some or all when you reserve the instance. There is no cost benefit, that I can see. However, as a new account, you most likely can\u2019t do no up-front.</p><p>Per AWS Support:</p><blockquote>No Upfront Reserved Instances (RIs) can pose a significant billing risk to new accounts, as they\u2019re a contractual obligation to pay monthly for the entire term of the RI. For this reason, new accounts and lightly used accounts are unable to sign up for No Upfront RIs until a successful billing history is built with us.</blockquote><p>You may run into this error if you try and buy a no up-front.</p><blockquote>Error : Your current quota does not allow you to purchase the required number of reserved instances (Service: AmazonEC2; Status Code: 400; Error Code: ReservedInstancesLimitExceeded;)</blockquote><p>Caveat: For whatever reason, it takes a bit for the the reserved instance to \u201ckick-in\u201d which means the first day of the month always costs more. I\u2019m not sure why this is, but if I figure it out, I\u2019ll update this. See graph below:</p><figure><img alt=\"JNI-ha2AnV7fhXmn8AbusMNAY33UW6mug6lW\" height=\"367\" loading=\"lazy\" src=\"https://cdn-media-1.freecodecamp.org/images/JNI-ha2AnV7fhXmn8AbusMNAY33UW6mug6lW\" width=\"800\"/></figure><h3 id=\"pain-points\">Pain Points</h3><p>These are just some minor complaints about the overall EBS, which I figured I\u2019d include as an addendum to my original article, in case you\u2019re curious.</p><h4 id=\"automatic-updates-aren-t-really-that-automatic\">Automatic updates aren\u2019t really that automatic</h4><p>Node versions don\u2019t line up from version to version.</p><p>Refer to the step below on how I manage changing Linux versions when Node doesn\u2019t work.</p><h4 id=\"running-more-than-one-environment\">Running more than one environment</h4><p>Having a development environment and a production running at the same time is easy, but it\u2019s expensive. It doubles it, in fact. Therefore, I usually destroy the dev environment as soon as I\u2019m done with it.</p><h4 id=\"documentation-is-horrendous\">Documentation is horrendous</h4><p>AWS is too big for its own good. That is part of why I\u2019m writing this. It was really hard to find answers to my specific needs.</p><h3 id=\"how-i-manage-updates\">How I manage Updates</h3><p>I have two separate instances of my Git repo installed on my laptop. I have one for dev, and one for production.</p><p>I use the dev environment to, well, develop! Pretty straightforward. I use the production folder solely for the purpose of pulling updates from Git master branch, running my webpack configuration and deploying to the production server.</p><p>The reason they are separate is because I can maintain separate elastic beanstalk configurations and not have to worry about deploying to the wrong place.</p><h4 id=\"updates-not-requiring-a-linux-environment-change\">Updates not requiring a Linux Environment change</h4><p>For updates not requiring any changes to the linux environment, it\u2019s as simple as running <code>eb deploy</code> in the terminal. It\u2019s amazing and takes about 10 minutes to propagate.</p><h4 id=\"updates-requiring-a-linux-environment-change\">Updates requiring a Linux Environment change</h4><p>Occasionally, you will want to update the Linux environment but will be unable too because AWS is freaking dumb (I\u2019m sure there\u2019s a reason) and only allows certain versions of Node on each Linux build. For this, it\u2019s a bit more complicated, but manageable.</p><ol><li>Push to production config under new env. The last time I did this, I just created a new instance via <code>eb create prod-1</code> . It\u2019ll do what it needs to and deploy your app to a new environment.</li><li>Make sure all your updates work. Seems pretty obvious, but this is a good time to make sure there weren\u2019t any hiccups with the new build.</li><li>Make sure your env vars are setup correctly. This is sorta part of the previous version, but make sure you\u2019re pulling from the right DB, or whatever.</li><li>Make sure your load balancer has the same SSL cert (if applicable). Fun fact, if you try to access an ELB instance in https without a certificate, it will fail!</li><li>Swap the instances. Finally, after everything looks good to go, there\u2019s a button in the console to swap the instance urls. EASY PEASY. You don\u2019t have to change anything in the Route 53, it does it all for you.</li></ol><p>So, there you have it. How to manage your updates. Pretty easy.</p><h3 id=\"final-thoughts\">Final Thoughts</h3><p>If you have any suggestions to make it cheaper/easier, I would love to hear them. I like the discussion about tools and options just as much as the next developer!</p><p>With that, I\u2019ll leave with this: Happy coding!</p>\n</section>\n<hr/>\n<p>\n        Learn to code for free. freeCodeCamp's open source curriculum has helped more than 40,000 people get jobs as developers. <a href=\"https://www.freecodecamp.org/learn/\" id=\"learn-to-code-cta\" rel=\"noopener noreferrer\" target=\"_blank\">Get started</a>\n</p>\n</section>\n</article>\n</div></div>", "textContent": "\n            \n                \n                \n                \n                    \n                \n                \n                    \n                            \nby Jared NuttLessons learned from 2 years of running a production Node app on AWS\u2019 ELB platformFront-MatterLet\u2019s be honest, the AWS pricing calculator is confusing. Part of that is because of the a la carte method of payments AWS offers. This makes trying to give a good quote to a client difficult. Hopefully this article can provide some light on how much it costs to run an app, as well as some ways to reduce cost.The Real Cost of Running an AppI\u2019ve been managing a node web-app on ELB for about two years now. The first year was great, they gave you everything for free (mostly)! After that, you have to start paying for stuff, like EC2 instances.This article will focus on my specific app requirements, which is a node based express app that is hosted on Elastic Beanstalk.For full details about the build, see my previous article here.BreakdownThis is what I\u2019m currently running on AWS:Single EBS Environment (U.S. West Region):1 Classic Load Balancer1 t2.micro EC2 instanceS3 Bucket that holds images (7 GB at time of writing)1 Route 53 Hosted Zone$18 (Load Balancer) + $5 (EC2 with an RI) + $0.50 (Route 53) + $0.17 (S3) + $0.21 (Data Transfer) = Roughly $25 a month.Additionally, I host a MongoDB elsewhere, so if you plan on hosting a DB on AWS, that will incur additional costs. Let\u2019s break down the various costs.Load BalancerThis is the most expensive part of the stack. It costs:$0.025 per Classic Load Balancer-hour (or partial hour)$0.008 per GB of data processed by a Classic Load BalancerThat means, if you run your app 24 hours a day, it will cost roughly $18 + data charges, every month.EC2 InstanceOn-Demand EC2 instances are more expensive than they should be. To save some money here, refer to the section below about Reserved EC2 Instances. In case you were wondering, it would cost $8.40 to run the same type of EC2 instance as mentioned above, on-demand.S3I have a couple S3 buckets. One for my static home page, one for holding images and one for holding the application version. As far as I know, ELB automatically creates the one for managing the application versions.The S3 is pretty cheap, so I\u2019m not too worried about trying to nickel and dime it, but there are ways to save money via their Glacier system.DatabaseI host my MongoDB DB at mLab, which is going away soon. So I\u2019ll update this when I sort out how much that is actually gonna cost once I\u2019m forced to move over to Mongo\u2019s Atlas.Reserved EC2 InstancesLet\u2019s talk about Reserved Instances (RI). Amazon\u2019s convoluted billing system is the most confusing part about managing anything on AWS. Reserved Instances can alleviate some of the cost, but are way too confusing.After a lot of reading and talking with the AWS customer service, this is what I sorta figured out.First, there are two different ways you can reserve where the RI is: Regional and Availability Zone. Regional means, it is specific to one of the main regions, eg. us-west-2 (Oregon). The availability zone (AZ) is specific to a zone within that region, e.g. us-west-2a (Oregon).I bought an RI within us-west-2 and it was automatically applied to my instance running in that area. If you buy one within the AZ, it will only apply to the specific AZ, e.g. us-west-2a, so if ELB spins up an EC2 instance in us-west2b, you\u2019re out of luck.Additionally, there are \u201cstandard\u201d and \u201cconvertible\u201d types of RIs. I\u2019m not 100% on what that means, but from what I understand convertible is more flexible on what you can swap it to, but more expensive.Finally, there are three types of payment types: No Up-front, partial Up-front, All Up-Front. This is pretty straightforward, you either pay nothing, some or all when you reserve the instance. There is no cost benefit, that I can see. However, as a new account, you most likely can\u2019t do no up-front.Per AWS Support:No Upfront Reserved Instances (RIs) can pose a significant billing risk to new accounts, as they\u2019re a contractual obligation to pay monthly for the entire term of the RI. For this reason, new accounts and lightly used accounts are unable to sign up for No Upfront RIs until a successful billing history is built with us.You may run into this error if you try and buy a no up-front.Error : Your current quota does not allow you to purchase the required number of reserved instances (Service: AmazonEC2; Status Code: 400; Error Code: ReservedInstancesLimitExceeded;)Caveat: For whatever reason, it takes a bit for the the reserved instance to \u201ckick-in\u201d which means the first day of the month always costs more. I\u2019m not sure why this is, but if I figure it out, I\u2019ll update this. See graph below:Pain PointsThese are just some minor complaints about the overall EBS, which I figured I\u2019d include as an addendum to my original article, in case you\u2019re curious.Automatic updates aren\u2019t really that automaticNode versions don\u2019t line up from version to version.Refer to the step below on how I manage changing Linux versions when Node doesn\u2019t work.Running more than one environmentHaving a development environment and a production running at the same time is easy, but it\u2019s expensive. It doubles it, in fact. Therefore, I usually destroy the dev environment as soon as I\u2019m done with it.Documentation is horrendousAWS is too big for its own good. That is part of why I\u2019m writing this. It was really hard to find answers to my specific needs.How I manage UpdatesI have two separate instances of my Git repo installed on my laptop. I have one for dev, and one for production.I use the dev environment to, well, develop! Pretty straightforward. I use the production folder solely for the purpose of pulling updates from Git master branch, running my webpack configuration and deploying to the production server.The reason they are separate is because I can maintain separate elastic beanstalk configurations and not have to worry about deploying to the wrong place.Updates not requiring a Linux Environment changeFor updates not requiring any changes to the linux environment, it\u2019s as simple as running eb deploy in the terminal. It\u2019s amazing and takes about 10 minutes to propagate.Updates requiring a Linux Environment changeOccasionally, you will want to update the Linux environment but will be unable too because AWS is freaking dumb (I\u2019m sure there\u2019s a reason) and only allows certain versions of Node on each Linux build. For this, it\u2019s a bit more complicated, but manageable.Push to production config under new env. The last time I did this, I just created a new instance via eb create prod-1 . It\u2019ll do what it needs to and deploy your app to a new environment.Make sure all your updates work. Seems pretty obvious, but this is a good time to make sure there weren\u2019t any hiccups with the new build.Make sure your env vars are setup correctly. This is sorta part of the previous version, but make sure you\u2019re pulling from the right DB, or whatever.Make sure your load balancer has the same SSL cert (if applicable). Fun fact, if you try to access an ELB instance in https without a certificate, it will fail!Swap the instances. Finally, after everything looks good to go, there\u2019s a button in the console to swap the instance urls. EASY PEASY. You don\u2019t have to change anything in the Route 53, it does it all for you.So, there you have it. How to manage your updates. Pretty easy.Final ThoughtsIf you have any suggestions to make it cheaper/easier, I would love to hear them. I like the discussion about tools and options just as much as the next developer!With that, I\u2019ll leave with this: Happy coding!\n\n                        \n                    \n                    \n\n                    \n                    \n                        \n    \n\n\n\n\n\n    \n    \n\n\n                        \n\n\n        Learn to code for free. freeCodeCamp's open source curriculum has helped more than 40,000 people get jobs as developers. Get started\n    \n\n                    \n                \n                \n                    \n                \n            \n        ", "length": 8123, "excerpt": "by Jared Nutt\n\nThe reality of running a production Node app on AWS Elastic Beanstalk\nLessons learned from 2 years of running a production Node app on AWS\u2019 ELB\nplatform\nPhoto by Shane Rounce\n[https://unsplash.com/photos/1ZZ96uESRJQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText] \non Unsplash\n[https://unsplash.com/search/photos/technology?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText]\nFront-Matter\nLet\u2019s be honest, the AWS pricing calculator\n[https://calcula", "siteName": "freeCodeCamp.org", "publishedTime": "2019-05-21T16:08:21.000Z", "id": "8f71e758d6db2fcc47953e46038ee41e6e2b01ad", "url": "https://www.freecodecamp.org/news/the-reality-of-running-a-production-node-app-on-aws-elastic-beanstalk-55c78b5dad0b/", "domain": "freecodecamp.org", "date": "2023-12-27T18:09:28.208866", "resultUri": "http://localhost:3000/result/8f71e758d6db2fcc47953e46038ee41e6e2b01ad", "query": {"url": ["https://www.freecodecamp.org/news/the-reality-of-running-a-production-node-app-on-aws-elastic-beanstalk-55c78b5dad0b/"]}, "meta": {"og": {"site_name": "freeCodeCamp.org", "type": "article", "title": "The reality of running a production Node app on AWS Elastic Beanstalk", "description": "by Jared Nutt The reality of running a production Node app on AWS Elastic Beanstalk Lessons learned from 2 years of running a production Node app on AWS\u2019 ELB platform Photo by Shane Rounce [https://unsplash.com/photos/1ZZ96uESRJQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText]  on Unsplash [https://unsplash.com/search/photos/technology?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText] Front-Matter Let\u2019s be honest, the AWS pricing calculator [https://calcula", "url": "https://www.freecodecamp.org/news/the-reality-of-running-a-production-node-app-on-aws-elastic-beanstalk-55c78b5dad0b/", "image": "https://cdn-media-1.freecodecamp.org/images/1*sUif8A5X81bOpkLssOTbcg.jpeg", "image:width": "800", "image:height": "535"}, "twitter": {"card": "summary_large_image", "title": "The reality of running a production Node app on AWS Elastic Beanstalk", "description": "by Jared Nutt The reality of running a production Node app on AWS Elastic Beanstalk Lessons learned from 2 years of running a production Node app on AWS\u2019 ELB platform Photo by Shane Rounce [https://unsplash.com/photos/1ZZ96uESRJQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText]  on Unsplash [https://unsplash.com/search/photos/technology?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText] Front-Matter Let\u2019s be honest, the AWS pricing calculator [https://calcula", "url": "https://www.freecodecamp.org/news/the-reality-of-running-a-production-node-app-on-aws-elastic-beanstalk-55c78b5dad0b/", "image": "https://cdn-media-1.freecodecamp.org/images/1*sUif8A5X81bOpkLssOTbcg.jpeg", "label1": "Written by", "data1": "freeCodeCamp.org", "label2": "Filed under", "data2": "AWS, JavaScript, Nodejs, Programming, DevOps", "site": "@freecodecamp"}}}