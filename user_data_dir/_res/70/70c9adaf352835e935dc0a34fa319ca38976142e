{"title": "How I built a customizable loading-indicator with Angular dynamic components", "byline": "Bal\u00e1zs T\u00e1pai", "dir": null, "lang": "en", "content": "<div class=\"page\" id=\"readability-page-1\"><div id=\"site-main\">\n<article><h1>How I built a customizable loading-indicator with Angular dynamic components</h1>\n<section>\n<section data-test-label=\"post-content\">\n<p>Recently, I wrote a <a href=\"https://medium.com/@balazs.tapai1990/how-to-create-reusable-loading-indicator-for-angular-projects-d0a11f4631e0?source=friends_link&amp;sk=9022f72306ac9adf2aea163dfa15fb05\" rel=\"noopener\">blog post</a> about creating a reusable loading-indicator component for Angular projects. The next step is making the indicator part customizable. But how exactly do you insert your component into the overlay? That is where dynamic components can help us.</p><p><strong><em>Note: </em></strong><em>Since my previous blog post, I have refactored some parts of the library. Feel free to check out the <a href=\"https://github.com/TapaiBalazs/angular-reusables\" rel=\"noopener\">git repository</a>.</em></p><p>The use-case is that we have a really easy to use loading-indicator. By default, it has a spinner, and it can be triggered using the library\u2019s decorator methods. However, our end user wants only \u201cLoading\u2026\u201d displayed on the overlay. We can copy the logic and then replace the spinner with the text itself, but that would be rather redundant.</p><p>In order to be able to use dynamic components, first, we need a simple decorator implemented. This decorator makes it possible to inject our own component into the template.</p><pre tabindex=\"0\"><code>import { Directive, ViewContainerRef } from '@angular/core';\n\n@Directive({\n  selector: '[btpIndicatorHost]',\n})\nexport class IndicatorHostDirective {\n  constructor(public viewContainerRef: ViewContainerRef) { }\n}</code></pre><p>We have to add this directive to our library\u2019s NgModule. Then replace the spinner component inside the loading-indicator template with the following:</p><pre tabindex=\"0\"><code>&lt;btp-overlay&gt;\n  &lt;div class=\"btp-loading-indicator__container\" [style.width]=\"indicatorSize\" [style.height]=\"indicatorSize\"&gt;\n    &lt;ng-template btpIndicatorHost&gt;&lt;/ng-template&gt;\n  &lt;/div&gt;\n&lt;/btp-overlay&gt;</code></pre><p>Now that we have this template, we need to do 3 things in the loading-indicator component.</p><ol><li>Inject the ComponentFactoryResolver into the component.</li><li>Use the @ViewChild decorator to get our indicator-host.</li><li>Load the provided component.</li></ol><pre tabindex=\"0\"><code>import {Component, ComponentFactoryResolver, ComponentRef, Inject, OnDestroy, OnInit, ViewChild} from '@angular/core';\nimport {LOADING_INDICATOR_CONFIG} from '../loading-indicator.config';\nimport {LoadingIndicatorConfig} from '../interfaces/loading-indicator.interfaces';\nimport {IndicatorHostDirective} from '../directives/indicator-host.directive';\nimport {SpinnerComponent} from '../spinner/spinner.component';\nimport {DEFAULT_SIZE, INDICATOR_COLOR} from '../constants/indicator.constants';\n\n@Component({\n  selector: 'btp-loading-indicator',\n  templateUrl: './loading-indicator.component.html',\n  styleUrls: ['./loading-indicator.component.css']\n})\nexport class LoadingIndicatorComponent implements OnInit, OnDestroy {\n  @ViewChild(IndicatorHostDirective)\n  host: IndicatorHostDirective;\n\n  constructor(@Inject(LOADING_INDICATOR_CONFIG)\n              private config: LoadingIndicatorConfig,\n              private componentFactoryResolver: ComponentFactoryResolver) {\n  }\n\n  get indicatorSize(): string {\n    return `${this.config.size}px`;\n  }\n\n  ngOnInit(): void {\n    this.loadComponent();\n  }\n\n  ngOnDestroy(): void {\n    this.host.viewContainerRef.clear();\n  }\n\n  private loadComponent() {\n    const component = this.config.indicatorComponent || SpinnerComponent;\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(component as any);\n    const viewContainerRef = this.host.viewContainerRef;\n    viewContainerRef.clear();\n    const componentRef: ComponentRef&lt;any&gt; = viewContainerRef.createComponent(componentFactory);\n    componentRef.instance.color = this.config.color || INDICATOR_COLOR;\n    componentRef.instance.size = this.config.size || DEFAULT_SIZE;\n  }\n}</code></pre><p>We need to load the component in the OnInit lifecycle hook. The OnInit hook runs after the first ngOnChanges(), and it is called only once. It is the ideal place to load a component dynamically into the DOM. We also need to clear the viewContainer reference during component destroy.</p><pre tabindex=\"0\"><code>  ngOnInit(): void {\n    this.loadComponent();\n  }\n\n  ngOnDestroy(): void {\n    this.host.viewContainerRef.clear();\n  }</code></pre><p>Let\u2019s examine our \u2018loadComponent\u2019 method a little bit further. We want to provide our custom components using our configuration logic. When a custom component is not provided in the config, our indicator will be the default spinner component.</p><pre tabindex=\"0\"><code>  private loadComponent() {\n    const component = this.config.indicatorComponent || SpinnerComponent;\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(component as any);\n    const viewContainerRef = this.host.viewContainerRef;\n    viewContainerRef.clear();\n    const componentRef: ComponentRef&lt;any&gt; = viewContainerRef.createComponent(componentFactory);\n    componentRef.instance.color = this.config.color || INDICATOR_COLOR;\n    componentRef.instance.size = this.config.size || DEFAULT_SIZE;\n  }</code></pre><p>Then we use the componentFactoryResolver, to get the component\u2019s factory. To be on the safe side, we clear our ViewContainerRef first. Then we create the component using the resolved factory, and we set our config values on the created instance.</p><p>Our end-user wants only a small text instead of a fancy spinner. A rather simple component would look like the following:</p><pre tabindex=\"0\"><code>import {Component} from '@angular/core';\n\n@Component({\n  selector: 'app-loading-message',\n  template: `&lt;h1&gt;Loading...&lt;/h1&gt;`,\n  styles: [``]\n})\nexport class LoadingMessageComponent {\n}</code></pre><p>We provide it in our app\u2019s main module, where we set up and configure our library. Adding the component into the \u2018entryComponents\u2019 array makes it sure that its factory can be resolved during loading.</p><p>From now on, we can replace the indicator component in any of our Angular projects, without the hustle of reimplementing most of the logic over and over again.</p><pre tabindex=\"0\"><code>@NgModule({\n  declarations: [AppComponent, LoadingMessageComponent],\n  imports: [\n    CommonModule,\n    AppRoutingModule,\n    LoadingIndicatorModule.forRoot(),\n  ],\n  providers: [\n    {\n      provide: LOADING_INDICATOR_CONFIG,\n      useValue: {\n        indicatorComponent: LoadingMessageComponent\n      }\n    }\n  ],\n  entryComponents: [LoadingMessageComponent]\n})\nexport class AppModule {\n}</code></pre><p><em>If you would like to learn more about Dynamic components, I recommend you to read: <a href=\"https://blog.angularindepth.com/here-is-what-you-need-to-know-about-dynamic-components-in-angular-ac1e96167f9e\" rel=\"noopener\">Here is what you need to know about dynamic components in Angular</a> by <a href=\"https://twitter.com/maxkoretskyi\" rel=\"noopener\"><strong>Max Koretskyi</strong></a></em></p><p>Thank you very much for reading this blog post. If you would like to try the above-mentioned lib out, you can find the package and instructions to install it <a href=\"https://www.npmjs.com/package/@btapai/ng-loading-indicator\" rel=\"noopener\">here</a>.</p><p><em>You can also follow me on <a href=\"https://twitter.com/TapaiBalazs\" rel=\"noopener\">Twitter</a> or <a href=\"https://github.com/TapaiBalazs\" rel=\"noopener\">GitHub</a>.</em></p>\n</section>\n<hr/>\n<hr/>\n<p>\n        Learn to code for free. freeCodeCamp's open source curriculum has helped more than 40,000 people get jobs as developers. <a href=\"https://www.freecodecamp.org/learn/\" id=\"learn-to-code-cta\" rel=\"noopener noreferrer\" target=\"_blank\">Get started</a>\n</p>\n</section>\n</article>\n</div></div>", "textContent": "\n            \n                \n                \n                \n                    \n                \n                \n                    \n                            \nRecently, I wrote a blog post about creating a reusable loading-indicator component for Angular projects. The next step is making the indicator part customizable. But how exactly do you insert your component into the overlay? That is where dynamic components can help us.Note: Since my previous blog post, I have refactored some parts of the library. Feel free to check out the git repository.The use-case is that we have a really easy to use loading-indicator. By default, it has a spinner, and it can be triggered using the library\u2019s decorator methods. However, our end user wants only \u201cLoading\u2026\u201d displayed on the overlay. We can copy the logic and then replace the spinner with the text itself, but that would be rather redundant.In order to be able to use dynamic components, first, we need a simple decorator implemented. This decorator makes it possible to inject our own component into the template.import { Directive, ViewContainerRef } from '@angular/core';\n\n@Directive({\n  selector: '[btpIndicatorHost]',\n})\nexport class IndicatorHostDirective {\n  constructor(public viewContainerRef: ViewContainerRef) { }\n}We have to add this directive to our library\u2019s NgModule. Then replace the spinner component inside the loading-indicator template with the following:<btp-overlay>\n  <div class=\"btp-loading-indicator__container\" [style.width]=\"indicatorSize\" [style.height]=\"indicatorSize\">\n    <ng-template btpIndicatorHost></ng-template>\n  </div>\n</btp-overlay>Now that we have this template, we need to do 3 things in the loading-indicator component.Inject the ComponentFactoryResolver into the component.Use the @ViewChild decorator to get our indicator-host.Load the provided component.import {Component, ComponentFactoryResolver, ComponentRef, Inject, OnDestroy, OnInit, ViewChild} from '@angular/core';\nimport {LOADING_INDICATOR_CONFIG} from '../loading-indicator.config';\nimport {LoadingIndicatorConfig} from '../interfaces/loading-indicator.interfaces';\nimport {IndicatorHostDirective} from '../directives/indicator-host.directive';\nimport {SpinnerComponent} from '../spinner/spinner.component';\nimport {DEFAULT_SIZE, INDICATOR_COLOR} from '../constants/indicator.constants';\n\n@Component({\n  selector: 'btp-loading-indicator',\n  templateUrl: './loading-indicator.component.html',\n  styleUrls: ['./loading-indicator.component.css']\n})\nexport class LoadingIndicatorComponent implements OnInit, OnDestroy {\n  @ViewChild(IndicatorHostDirective)\n  host: IndicatorHostDirective;\n\n  constructor(@Inject(LOADING_INDICATOR_CONFIG)\n              private config: LoadingIndicatorConfig,\n              private componentFactoryResolver: ComponentFactoryResolver) {\n  }\n\n  get indicatorSize(): string {\n    return `${this.config.size}px`;\n  }\n\n  ngOnInit(): void {\n    this.loadComponent();\n  }\n\n  ngOnDestroy(): void {\n    this.host.viewContainerRef.clear();\n  }\n\n  private loadComponent() {\n    const component = this.config.indicatorComponent || SpinnerComponent;\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(component as any);\n    const viewContainerRef = this.host.viewContainerRef;\n    viewContainerRef.clear();\n    const componentRef: ComponentRef<any> = viewContainerRef.createComponent(componentFactory);\n    componentRef.instance.color = this.config.color || INDICATOR_COLOR;\n    componentRef.instance.size = this.config.size || DEFAULT_SIZE;\n  }\n}We need to load the component in the OnInit lifecycle hook. The OnInit hook runs after the first ngOnChanges(), and it is called only once. It is the ideal place to load a component dynamically into the DOM. We also need to clear the viewContainer reference during component destroy.  ngOnInit(): void {\n    this.loadComponent();\n  }\n\n  ngOnDestroy(): void {\n    this.host.viewContainerRef.clear();\n  }Let\u2019s examine our \u2018loadComponent\u2019 method a little bit further. We want to provide our custom components using our configuration logic. When a custom component is not provided in the config, our indicator will be the default spinner component.  private loadComponent() {\n    const component = this.config.indicatorComponent || SpinnerComponent;\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(component as any);\n    const viewContainerRef = this.host.viewContainerRef;\n    viewContainerRef.clear();\n    const componentRef: ComponentRef<any> = viewContainerRef.createComponent(componentFactory);\n    componentRef.instance.color = this.config.color || INDICATOR_COLOR;\n    componentRef.instance.size = this.config.size || DEFAULT_SIZE;\n  }Then we use the componentFactoryResolver, to get the component\u2019s factory. To be on the safe side, we clear our ViewContainerRef first. Then we create the component using the resolved factory, and we set our config values on the created instance.Our end-user wants only a small text instead of a fancy spinner. A rather simple component would look like the following:import {Component} from '@angular/core';\n\n@Component({\n  selector: 'app-loading-message',\n  template: `<h1>Loading...</h1>`,\n  styles: [``]\n})\nexport class LoadingMessageComponent {\n}We provide it in our app\u2019s main module, where we set up and configure our library. Adding the component into the \u2018entryComponents\u2019 array makes it sure that its factory can be resolved during loading.From now on, we can replace the indicator component in any of our Angular projects, without the hustle of reimplementing most of the logic over and over again.@NgModule({\n  declarations: [AppComponent, LoadingMessageComponent],\n  imports: [\n    CommonModule,\n    AppRoutingModule,\n    LoadingIndicatorModule.forRoot(),\n  ],\n  providers: [\n    {\n      provide: LOADING_INDICATOR_CONFIG,\n      useValue: {\n        indicatorComponent: LoadingMessageComponent\n      }\n    }\n  ],\n  entryComponents: [LoadingMessageComponent]\n})\nexport class AppModule {\n}If you would like to learn more about Dynamic components, I recommend you to read: Here is what you need to know about dynamic components in Angular by Max KoretskyiThank you very much for reading this blog post. If you would like to try the above-mentioned lib out, you can find the package and instructions to install it here.You can also follow me on Twitter or GitHub.\n\n                        \n                    \n                    \n                        \n                        \n                    \n\n                    \n                    \n                        \n    \n\n\n\n\n\n    \n    \n\n\n                        \n\n\n        Learn to code for free. freeCodeCamp's open source curriculum has helped more than 40,000 people get jobs as developers. Get started\n    \n\n                    \n                \n                \n                    \n                \n            \n        ", "length": 6921, "excerpt": "Recently, I wrote a blog post\n[https://medium.com/@balazs.tapai1990/how-to-create-reusable-loading-indicator-for-angular-projects-d0a11f4631e0?source=friends_link&sk=9022f72306ac9adf2aea163dfa15fb05] \nabout creating a reusable loading-indicator component for Angular projects. The\nnext step is making the indicator part customizable. But how exactly do you\ninsert your component into the overlay? That is where dynamic components can\nhelp us.\n\nNote: Since my previous blog post, I have refactored som", "siteName": "freeCodeCamp.org", "publishedTime": "2019-05-06T17:27:13.000Z", "id": "70c9adaf352835e935dc0a34fa319ca38976142e", "url": "https://www.freecodecamp.org/news/how-i-built-a-customizable-loading-indicator-with-angular-dynamic-components-a291310f01d/", "domain": "freecodecamp.org", "date": "2023-12-27T18:10:33.589990", "resultUri": "http://localhost:3000/result/70c9adaf352835e935dc0a34fa319ca38976142e", "query": {"url": ["https://www.freecodecamp.org/news/how-i-built-a-customizable-loading-indicator-with-angular-dynamic-components-a291310f01d/"]}, "meta": {"og": {"site_name": "freeCodeCamp.org", "type": "article", "title": "How I built a customizable loading-indicator with Angular dynamic components", "description": "Recently, I wrote a blog post [https://medium.com/@balazs.tapai1990/how-to-create-reusable-loading-indicator-for-angular-projects-d0a11f4631e0?source=friends_link&sk=9022f72306ac9adf2aea163dfa15fb05]  about creating a reusable loading-indicator component for Angular projects. The next step is making the indicator part customizable. But how exactly do you insert your component into the overlay? That is where dynamic components can help us. Note: Since my previous blog", "url": "https://www.freecodecamp.org/news/how-i-built-a-customizable-loading-indicator-with-angular-dynamic-components-a291310f01d/", "image": "https://cdn-media-1.freecodecamp.org/images/1*1yD1jhrSV5Kmd7Ee4OMxPg.jpeg", "image:width": "800", "image:height": "533"}, "twitter": {"card": "summary_large_image", "title": "How I built a customizable loading-indicator with Angular dynamic components", "description": "Recently, I wrote a blog post [https://medium.com/@balazs.tapai1990/how-to-create-reusable-loading-indicator-for-angular-projects-d0a11f4631e0?source=friends_link&sk=9022f72306ac9adf2aea163dfa15fb05]  about creating a reusable loading-indicator component for Angular projects. The next step is making the indicator part customizable. But how exactly do you insert your component into the overlay? That is where dynamic components can help us. Note: Since my previous blog", "url": "https://www.freecodecamp.org/news/how-i-built-a-customizable-loading-indicator-with-angular-dynamic-components-a291310f01d/", "image": "https://cdn-media-1.freecodecamp.org/images/1*1yD1jhrSV5Kmd7Ee4OMxPg.jpeg", "label1": "Written by", "data1": "Bal\u00e1zs T\u00e1pai", "label2": "Filed under", "data2": "JavaScript, Tech, Angular, Front End Development, Programming", "site": "@freecodecamp", "creator": "@TapaiBalazs"}}}